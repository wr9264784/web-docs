<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.14" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.50" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <title>浏览器渲染原理 | Web Docs</title><meta name="description" content="记录 Web 开发中的原理、问题和案例">
    <link rel="preload" href="/web-docs/assets/style-DrAPEObx.css" as="style"><link rel="stylesheet" href="/web-docs/assets/style-DrAPEObx.css">
    <link rel="modulepreload" href="/web-docs/assets/app-Bgb0RMc4.js"><link rel="modulepreload" href="/web-docs/assets/index.html-seg2lhtU.js"><link rel="modulepreload" href="/web-docs/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/web-docs/assets/index.html-DC7eHlBY.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dg5ojZX8.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DH13gVXB.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BAf8nXny.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CG8AgjOq.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CxKM8Uwv.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CZu_8OZb.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BNVbAw8P.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BmWO0gdM.js" as="script"><link rel="prefetch" href="/web-docs/assets/REAEME.html-B3BrqFZ9.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-C3iRpema.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CfnHkHUd.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BWI56l59.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DC5KbkFa.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DtfO0EPu.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DxQQaJ46.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BStKW6RC.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DgWkyP0T.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-ClHe0ITo.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BHCgRJSg.js" as="script"><link rel="prefetch" href="/web-docs/assets/介绍.html-D9TRJGY-.js" as="script"><link rel="prefetch" href="/web-docs/assets/绘制图形.html-C3en_Udv.js" as="script"><link rel="prefetch" href="/web-docs/assets/绘制图片.html-DMY2Fuxg.js" as="script"><link rel="prefetch" href="/web-docs/assets/绘制文本.html-Nd8LfuFi.js" as="script"><link rel="prefetch" href="/web-docs/assets/绘图样式.html-CDNhyPRx.js" as="script"><link rel="prefetch" href="/web-docs/assets/进阶.html-tsFsySSl.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-pD7YqUOY.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DgaMVuFG.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BXCUQ7Zh.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DSJPSGjl.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DAAbJWDH.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DN1lqzGx.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dc7vV_V9.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DQh8dRd6.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-d1C9jaSi.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-O81GunRz.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DmSmMK4U.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-ClFefMMs.js" as="script"><link rel="prefetch" href="/web-docs/assets/Webpack5_基础.html-B6BqC356.js" as="script"><link rel="prefetch" href="/web-docs/assets/Webpack5_搭建脚手架.html-D9niOSIs.js" as="script"><link rel="prefetch" href="/web-docs/assets/Webpack5_高级.html-BbCaHoK6.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-GOyEogZm.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BiJr1EJ7.js" as="script"><link rel="prefetch" href="/web-docs/assets/READEME.html-DjH-gJ9I.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-a6ZtTQCf.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html--EmOj9Bm.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dqe7HZWF.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D1cT8yL-.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DeKqAjAQ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-B3AkOlWB.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dy0TRvu5.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-qDCs-A7a.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BCWuxdz3.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-C49EBchJ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D4tcapN5.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CNNlTGFZ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BLgyw7ck.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CzDkgQn4.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BBMtOYPz.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-_rFzpzhI.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CP_qnZss.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BBqDCi6R.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CfniYM_S.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CYbkbI8h.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-xK_Oq9wT.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-B0mQK_JX.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BHlWSYMu.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CA-guxnR.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CfPa_mCL.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Wy9cFycZ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dh4ZgNP8.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Cs1SxWwt.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BfHqPACM.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dr-Htp79.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BpsDIAE5.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CKRye2CX.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BhBASWz2.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Cedtgvpw.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DlPlDf3V.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CMr-pyEz.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CwGIH0nw.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-C5Ag2mnH.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DaKGNCI6.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dx0iDPUi.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-S-rxo9Rs.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BGvyc0SG.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CVJkPiDm.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CT-pen2E.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CLTSBx1s.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D8yYultB.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BzuwJGOp.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DQWy04S0.js" as="script"><link rel="prefetch" href="/web-docs/assets/01-基本构造.html-CZw4LMp6.js" as="script"><link rel="prefetch" href="/web-docs/assets/02-抽离-封装-优化.html--P22AT54.js" as="script"><link rel="prefetch" href="/web-docs/assets/03-封装操作微队列函数.html-BD6Gz5_y.js" as="script"><link rel="prefetch" href="/web-docs/assets/04-then函数的实现.html-B5j-a_sk.js" as="script"><link rel="prefetch" href="/web-docs/assets/05-执行队列函数.html-VG5BwC9C.js" as="script"><link rel="prefetch" href="/web-docs/assets/06-核心代码.html-CKI58Obz.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D2ZspN1J.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Cz1rUdyZ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BRKHmW88.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-RGaJtD8i.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D8U9piiD.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-tk-O5Lm5.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CVxX73db.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CLA7Jx-K.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DAOt3fyc.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-559fwGny.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-9agwTm4m.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-sulCfu6j.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D657-w5y.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BZDul65w.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CUE5uzym.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D40lQ-fU.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DrXp-bqR.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DYVDHBhn.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D1WXFTiq.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CI-fgftI.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-sI5dkB4m.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DKSd8Duk.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DT5ypzlO.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D1d-Tjj_.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-B9OtLPa2.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-p5Keb7rU.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-B4Sb7quZ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-sGwPN89v.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BT3Tt_-R.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DxlkdliY.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-OkGtyxnh.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D3NfXENk.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CyqlRdHX.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D69roD0W.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-tz1UZvhJ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D4h595MV.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Bd63yxT4.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CliESPMK.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BbG3HwSM.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-C8DgxsiN.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CleXMThy.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DEeM4Gxj.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-B9G5sWkx.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-B_YL-3-l.js" as="script"><link rel="prefetch" href="/web-docs/assets/404.html-BrYKXYfz.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DOoadB4s.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-RuFnFwKy.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BGlx9wDv.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CqMIpTuQ.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CYLqV5ZY.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-B6UxO2-l.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DMJGPyLX.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BsikhvsG.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-X7IZkoDP.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BvknBb8C.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-TjX2rhu4.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CfWjF8Wv.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-C2XZ0M9P.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BRxhBohf.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BTMW29Hj.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-ivluj0SE.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-NNb6BVJi.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Ce4Gcr_O.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D4iLMck2.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DeOOQ8OG.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-hoG3wBga.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-C12UI10m.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-18cMnmw6.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CkIPRQik.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DBdhdy6f.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BBTLPlAj.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DvOx5dZ_.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CJxzd8eq.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-4FsJZzGg.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D2a1jKi5.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CvYUMmx_.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D2w8FXX8.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-3Mk_lgJW.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DTU2zeCs.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DGod-YzH.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BW9Amh3p.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DZ5VThCR.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Bxb6GSc1.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-D5S8_bxG.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-PKon_u9E.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html--V6yPT2S.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DOqw4tSv.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DeZUirVi.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dt0z2EpE.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DAolqXEo.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CIv-OYe4.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BMxNsDgY.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BUacUQlY.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-baG5Pxx0.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DyT90KS9.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CKWD8_Zf.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-ukMhunct.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-MeuHszJB.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BitTUDOz.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CvTOUfxe.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dg3r1g2H.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BE_hSyA_.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BavY54z-.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DsMA9Yoi.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Bi1II981.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-DDeekY7P.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-sA2Yirhb.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BhKkmIlu.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Bpm7SVDO.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CdXT4Jvx.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-T4Sdctmp.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CIXBfz5Q.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-C4-3V49d.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CLItaOvG.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-CazzpITK.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-QXZsfhfX.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-Dt3pW4EP.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-taga3NT8.js" as="script"><link rel="prefetch" href="/web-docs/assets/index.html-BE4j5fn9.js" as="script"><link rel="prefetch" href="/web-docs/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/web-docs/"><img class="vp-nav-logo" src="/web-docs/images/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Web Docs</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="前端"><!--[--><!---->前端<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/" aria-label="浏览器"><!---->浏览器<!----></a></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">前端三件套</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97/HTML/" aria-label="HTML"><!---->HTML<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97/CSS/" aria-label="CSS"><!---->CSS<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97/JavaScript/" aria-label="JavaScript"><!---->JavaScript<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E4%B8%89%E4%BB%B6%E5%A5%97/%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B/" aria-label="三件套综合案例"><!---->三件套综合案例<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/TypeScript/" aria-label="TypeScript"><!---->TypeScript<!----></a></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">图形化展示</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B1%95%E7%A4%BA/SVG/" aria-label="SVG"><!---->SVG<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B1%95%E7%A4%BA/Canvas/Canvas%E7%9A%84%E4%BD%BF%E7%94%A8/%E4%BB%8B%E7%BB%8D.html" aria-label="Canvas"><!---->Canvas<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">工程化</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/Webpack/" aria-label="Webpack"><!---->Webpack<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/前端/工程化/Vite.html" aria-label="Vite"><!---->Vite<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/Rollup/" aria-label="Rollup"><!---->Rollup<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E5%B7%A5%E7%A8%8B%E5%8C%96/Monorepo/" aria-label="Monorepo"><!---->Monorepo<!----></a></li></ul></li><li class="vp-dropdown-item"><h4 class="vp-dropdown-subtitle">框架</h4><ul class="vp-dropdown-subitems"><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/Vue/" aria-label="Vue"><!---->Vue<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/React/" aria-label="React"><!---->React<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/%E8%B7%A8%E5%B9%B3%E5%8F%B0/" aria-label="跨平台"><!---->跨平台<!----></a></li><li class="vp-dropdown-subitem"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E6%A1%86%E6%9E%B6/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" aria-label="小程序"><!---->小程序<!----></a></li></ul></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web-docs/%E5%89%8D%E7%AB%AF/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" aria-label="性能优化"><!---->性能优化<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="后端"><!--[--><!---->后端<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web-docs/%E5%90%8E%E7%AB%AF/NodeJS/" aria-label="NodeJS"><!---->NodeJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web-docs/datadb.html" aria-label="数据库"><!---->数据库<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="面试题"><!--[--><!---->面试题<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/web-docs/%E9%9D%A2%E8%AF%95%E9%A2%98/%E5%89%8D%E7%AB%AF/TypeScript/" aria-label="前端"><!---->前端<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/web-docs/%E5%89%8D%E7%AB%AF/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E5%8E%9F%E7%90%86/" aria-label="渲染原理"><!--[--><span class="font-icon icon iconfont icon-wenjian" style=""></span><!--]-->渲染原理<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/web-docs/%E5%89%8D%E7%AB%AF/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6/" aria-label="事件循环机制"><!--[--><span class="font-icon icon iconfont icon-wenjian" style=""></span><!--]-->事件循环机制<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/web-docs/%E5%89%8D%E7%AB%AF/Browser/%E8%B7%A8%E5%9F%9F/" aria-label="跨域问题"><!--[--><span class="font-icon icon iconfont icon-wenjian" style=""></span><!--]-->跨域问题<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/web-docs/%E5%89%8D%E7%AB%AF/Browser/Http%E7%BC%93%E5%AD%98/" aria-label="Http 缓存"><!--[--><span class="font-icon icon iconfont icon-wenjian" style=""></span><!--]-->Http 缓存<!----></a></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->浏览器渲染原理</h1><div class="page-info"><!----><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-07-06T22:04:22.000Z"></span><!----><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 33 分钟</span><meta property="timeRequired" content="PT33M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#渲染">渲染</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#渲染的时间点">渲染的时间点</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#渲染流水线-渲染流程">渲染流水线（渲染流程）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_1-解析-html-parse-html">1. 解析 HTML - Parse HTML</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#_1-html-解析过程中遇到-css-代码怎么办">（1）HTML 解析过程中遇到 CSS 代码怎么办？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level5" href="#_2-html-解析遇到-js-代码怎么办">（2）HTML 解析遇到 JS 代码怎么办？</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_2-样式计算-recalculate-style">2. 样式计算 - Recalculate Style</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_3-布局-layout">3. 布局 - Layout</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_4-分层-layer">4. 分层 - Layer</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_5-绘制-paint">5. 绘制 - Paint</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_6-分块-tiling">6. 分块 - Tiling</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_7-光栅化-raster">7. 光栅化 - Raster</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#_8-画-draw">8. 画 - Draw</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#完整过程总结">完整过程总结</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#reflow">Reflow</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#repaint">Repaint</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#面试题">面试题</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#在浏览器的地址栏输入一个地址-按下回车后发生了什么事">在浏览器的地址栏输入一个地址，按下回车后发生了什么事?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#浏览器是如何渲染页面的">浏览器是如何渲染页面的？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#什么是-reflow">什么是 reflow？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#什么是-repaint">什么是 repaint？</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level4" href="#为什么-transform-效率高">为什么 transform 效率高？</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="浏览器渲染原理" tabindex="-1"><a class="header-anchor" href="#浏览器渲染原理"><span>浏览器渲染原理</span></a></h1><h3 id="渲染" tabindex="-1"><a class="header-anchor" href="#渲染"><span>渲染</span></a></h3><p>首先，第一个问题是：什么叫 <strong>渲染</strong>，渲染的单词是 <strong>render</strong>。这个单词在不同的场景中含义是不一样的，例如在前端框架 vue 和 react 中也有 render 渲染，但是这两个框架中的 render 表示的是得到一个虚拟 Dom。而现实中，比如我们看的动画中也有 render，但是这里的 render 指的是把一个动画的 3D 模型变成一帧一帧的画面，这个就叫渲染。</p><p>而 <strong>浏览器中的渲染原理</strong> 这一块，它的 <strong>渲染</strong> 指的是什么？就这么一件事：就是 <strong>把一个 HTML 字符串变成屏幕上的像素信息，整个过程称之为 &quot;渲染&quot;</strong>。</p><p>浏览器底层的渲染工作是极其复杂的，所以我们可以用一个简单的函数模型就可以描述出渲染到底是什么：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 把渲染简单地理解为一个函数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">// 接受一个 html 字符串，得到的是一个像素信息</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> render</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#E06C75;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">html</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 得到的是一个像素信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 这个像素信息里边要描述：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 第一行的第一个像素的颜色、第二个像素的颜色、第三个像素的颜色...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 第二行的第一个像素的颜色、第二个像素的颜色、第三个像素的颜色...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 第...行...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 整个过程，把它放到 pixels 变量里边，并返回，这就是渲染</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    // 只要你能够得到像素点的颜色，交给 GPU、交给显卡，就能把页面呈现到屏幕上，就完成了一次渲染</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> pixels</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>渲染过程如下图所示：</p><p><img src="/web-docs/assets/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%B2%E6%9F%93%E8%BF%87%E7%A8%8B-BIS39XsS.png" alt="浏览器渲染过程"></p><p>上图中：渲染实际上就是把一个 HTML 字符串 经过一套非常复杂的工序，环环相扣、精密的配合 最终完成了每一个像素点的信息并呈现到页面上。</p><h3 id="渲染的时间点" tabindex="-1"><a class="header-anchor" href="#渲染的时间点"><span>渲染的时间点</span></a></h3><p>当我们理解了渲染之后，我们接下来一步步地逐渐深入。那么这个渲染发生在什么时候呢？就是什么时候我需要启动这件事？这个知识就跟 <strong>浏览器的事件循环</strong> 产生联系了，如下图所示：</p><p><img src="/web-docs/assets/%E6%B8%B2%E6%9F%93%E7%9A%84%E6%97%B6%E9%97%B4%E7%82%B9-DrOQ-2Zm.png" alt="渲染的时间点"></p><p>其实，有一道 <strong>面试题</strong> 是这么问的：<strong>问在浏览器的地址栏输入一个地址，按下回车后发生了什么事</strong>？</p><p>从按下回车键到呈现整个页面，只有那么不到一秒的时间，这不到一秒的时间里，到底发生了什么事？那事情可多了去了，但是重点来说的话，就是两块。一块是 <strong>网络</strong>，另一块就是 <strong>渲染</strong>。</p><ul><li>网络： <ul><li>网络的整个过程细节特别复杂。这里不细说，总的来说就是去服务器里拿 <code>HTML</code>（里边已经包含了 <code>CSS</code> 和 <code>JS</code>，用到 <code>link</code> 和 <code>script</code> 进行引入了），拿到 <code>HTML</code> 就拿到了页面的一切。拿到 <code>HTML</code> 后就会交给另一个东西来进行渲染。</li><li>浏览器中是谁去拿这个 <code>HTML</code> 字符串的？其实是浏览器中的 <strong>网络线程</strong>，如上图所示。当 <strong>网络线程</strong> 拿到了 这个 <code>HTML</code> 字符串后，并不能处理页面渲染，而是生成一个 <strong>渲染任务</strong>。那么这个渲染任务要交给谁呢？其实是给到了 <strong>消息队列</strong>，如上图所示。</li></ul></li><li>渲染： <ul><li><strong>渲染主线程</strong> 拿到了这个 <strong>渲染任务</strong> 之后就启动了 <strong>渲染流程</strong>（这就是 <strong>渲染的时间点</strong>）。</li><li>那么这个 <strong>渲染流程</strong> 里是怎么去渲染的？</li></ul></li></ul><h3 id="渲染流水线-渲染流程" tabindex="-1"><a class="header-anchor" href="#渲染流水线-渲染流程"><span>渲染流水线（渲染流程）</span></a></h3><p>渲染流水线如下图所示：</p><p><img src="/web-docs/assets/%E6%B8%B2%E6%9F%93%E6%B5%81%E6%B0%B4%E7%BA%BF-DuLVM164.png" alt="渲染流水线"></p><p>总的来说，渲染流程是：</p><p><strong>当浏览器的网络线程收到 HTML 文件后，会产生一个渲染任务，并将其传递给渲染主线程的消息队列。在事件循环机制的作用下，渲染主线程取出消息队列中的渲染任务，开启渲染流程</strong>。</p><p>整个 <strong>渲染流程</strong> 分为多个阶段，分别是 <strong>HTML 解析</strong>、<strong>样式计算</strong>、<strong>布局</strong>、<strong>分层</strong>、<strong>绘制</strong>、<strong>分块</strong>、<strong>光栅化</strong>、<strong>画</strong>。每个阶段都有明确的输入输出，<strong>上一个阶段的输出会变成下一个阶段的输入</strong>。这样，整个渲染流程就形成了一套组织严密的生产流水线。</p><h4 id="_1-解析-html-parse-html" tabindex="-1"><a class="header-anchor" href="#_1-解析-html-parse-html"><span>1. 解析 HTML - Parse HTML</span></a></h4><p>解析 <code>HTML</code> 过程如下图所示：</p><p><img src="/web-docs/assets/%E8%A7%A3%E6%9E%90HTML-BKmY1GX2.png" alt="解析HTML"></p><p>总体来说：</p><p>就是把一个 <code>HTML</code> 字符串放到我们 <strong>渲染流水线</strong> 中的 <strong>第一步</strong> 进行解析，然后它会产生两棵树：分别是 <strong><code>DOM</code>树</strong> 和 <strong><code>CSSOM</code>树</strong>。</p><p>这里需要解释一下什么叫做 <strong>树</strong>？为什么叫做树呢？在上图中如果我们把 <strong><code>DOM</code>树</strong> 和 <strong><code>CSSOM</code>树</strong> 倒过来看，它就是一棵树，下边是树的根，上面的树的分支，最终的是树的叶子。如下图所示：</p><p><img src="/web-docs/assets/DOM%E6%A0%91-DW73xxgA.png" alt="DOM树"><img src="/web-docs/assets/CSSOM%E6%A0%91-DAug1l-c.png" alt="CSSOM树"></p><p>树里边有很多的节点组成（也就是框框里的内容），其实这些节点在我们代码的环境里边是什么呢？其实就是 <code>JS</code> 对象。其实我们平时在前端开发的时候，就接触到过这个树形结构。什么树形结构呢？<code>DOM</code> 就是一个树形结构，也就是 <code>document</code> 对象。</p><p>好，理解了什么是树后，我们回到 <strong>渲染流水线</strong> 中的 <strong>第一步</strong>，产生了两棵树：<strong><code>DOM</code>树</strong> 和 <strong><code>CSSOM</code>树</strong>。</p><p>那么 <strong><code>DOM</code>树</strong> 是什么意思呢？<strong><code>DOM</code>树</strong> 叫做 <strong>Document Object Model</strong>，含义就是我们所有的 <code>HTML</code> 元素以及文本以及注释等等，也就是 <code>HTML</code> 文档里面所有的东西就会形成一个一个的对象，并且它们通过这个树形结构去关联。</p><p><strong><code>DOM</code>树</strong> 的大体结构如下图所示：</p><p>![Document Object Model](assets/Document Object Model.png)</p><p>比方说左边有一个 <code>HTML</code> 文档，经过了 **流水线 **中 <strong>第一步</strong> 的 <strong>parseHTML</strong> 解析转换后，就会形成最终右侧的一个结构。那么为什么要这样做呢？它为什么要把一个 <code>HTML</code> 字符串解析成这么一个树的结构呢？因为字符串是特别难以操作的，我们可以想象一下，如果直接把 <code>HTML</code> 字符串给你，让你取出某个元素节点的属性，你会发现很难实现。但是如果给你的是一个一个的对象，<strong>根节点 <code>document</code></strong>，通过这个根节点可以依次找到所有节点的信息。</p><p>所以，**流水线 **中 <strong>第一步</strong> 要做的事情就是让后续的步骤不再需要操作这个 <code>HTML</code> 字符串，而是去操作 <strong>第一步</strong> 中产生的这个 <strong>对象结构</strong>。<strong>它是给后续步骤做准备的</strong>。与此同时，<strong>也提供了 <code>JS</code> 操作这个树的能力</strong>。</p><p>那么 <strong><code>CSSOM树</code></strong> 是什么意思呢？ <strong><code>CSSOM树</code></strong> 叫做 <strong>CSS Object Model</strong>，当我们的 <code>HTML</code> 代码里边嵌套了一些 <code>CSS</code> 的时候，<code>CSS</code> 的语法规则和 <code>HTML</code> 不一样，所以它形成的结构也肯定不一样。</p><p><code>css</code> 里不可能像 <code>HTML</code> 那样，有一个 <code>div</code> 元素，然后里边有子元素等，<code>css</code> 里没有什么元素和子元素，<code>css</code> 里边有选择器、有规则，那么这些东西也得形成这么一个结构，它也是一个树形结构。</p><p><strong><code>CSSOM</code>树</strong> 的大体结构如下图所示：</p><p>![CSS Object Model](assets/CSS Object Model.png)</p><p>上图左边有一个 <code>HTML</code> 文档，并且内部有嵌套了 <code>CSS</code> 样式，经过了 **流水线 **中 <strong>第一步</strong> 的 <strong>parseHTML</strong> 解析转换后，会把 <code>HTML</code> 代码中的 <code>CSS</code> 代码进行解析，形成最右侧的一个 <strong>对象结构</strong>。跟 <code>HTML</code> 的结构一样，它首先会有一个 <strong>根节点</strong>，这个 <strong>根节点</strong> 就是代表着网页中 <strong>所有的样式表</strong>，那么 <strong>样式表</strong> 有哪些？</p><p>样式表有：<code>&lt;style&gt;&lt;/style&gt;</code> 内部样式表，<code>&lt;link&gt;&lt;/link&gt;</code> 外部样式表，<code>&lt;div style=&quot;xxx&quot;&gt;&lt;/div&gt;</code> 行内样式表，还有浏览器默认样式表。</p><p>那么浏览器的默认样式表有哪些，如下图所示：</p><p><img src="data:image/png;base64,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" alt="浏览器默认样式表"></p><p><strong><code>CSSOM</code>树</strong> 的大体结构图中，根节点 <code>StyleSheetList </code> 表示的是所有的 <code>CSSStyleSheet</code> 的一个列表集合。</p><p>而 <code>CSSStyleSheet</code> 节点就是一个样式表，如果我们的 <code>HTML</code> 代码中使用了 多种 <strong>样式表</strong>，那么右侧的结构中就会有多个 <code>CSSStyleSheet</code> 节点。</p><p>每个样式里边有很多的规则，例如结构图中的 CSS 代码就是一个个的规则：</p><div class="language-css line-numbers-mode" data-highlighter="shiki" data-ext="css" data-title="css" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* 这是一个规则 */</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* body h1 就是一个选择器 */</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;"> h1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    /* 下面的都是样式 */</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#ABB2BF;">    color</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#ABB2BF;">    font-size</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#D73A49;--shiki-dark:#E06C75;">em</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">/* 这也是一个规则 */</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;"> p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#ABB2BF;">    margin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#D73A49;--shiki-dark:#E06C75;">em</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#ABB2BF;">    color</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">blue</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这些规则就会形成一个一个的 <strong>规则对象</strong>，如结构图中的 <code>CSSStyleRule</code> 节点。<strong>规则</strong> 里边有 <strong>选择器</strong>，所以 <code>body h1</code> 就形成一个 <strong>选择器节点</strong>。<strong>规则</strong> 里边还有很多的样式，所以，结构图中的 <code>style</code> 节点就表示样式的集合，<code>style</code> 节点下面的节点就表示各种样式。</p><p>其实，<code>JS</code> 不仅能操作 <strong><code>DOM</code>树</strong>，还可以操作 <strong><code>CSSOM</code>树</strong>，它是怎么操作 <strong><code>CSSOM</code>树</strong> 的呢？</p><p>除了浏览器的默认样式之外，其他的样式 <code>JS</code> 都能操作，只不过我们平时操作最多的是 <strong>行内样式</strong>：</p><div class="language-js line-numbers-mode" data-highlighter="shiki" data-ext="js" data-title="js" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;"> box</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;"> document</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">querySelector</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&#39;.box&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">box</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E5C07B;">style</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">color</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &#39;red&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>至此，流水线的第一步骤其实已经大体完成了。但是，还没完，这里需要说明几个细节点：</p><h5 id="_1-html-解析过程中遇到-css-代码怎么办" tabindex="-1"><a class="header-anchor" href="#_1-html-解析过程中遇到-css-代码怎么办"><span>（1）<strong><code>HTML</code> 解析过程中遇到 <code>CSS</code> 代码怎么办</strong>？</span></a></h5><p><code>HTML</code> 字符串的解析是从上到下进行解析的，当解析到 <code>link</code> 标签的时候会怎么办呢？当解析到 <code>style</code> 标签的时候又会怎么办呢？</p><p>为了提高解析效率，浏览器会启动一个 <strong>预解析器（预解析线程）</strong> 率先下载和解析 <code>CSS</code>，如下图所示：</p><p><img src="/web-docs/assets/%E9%A2%84%E8%A7%A3%E6%9E%90%E5%99%A8%E8%A7%A3%E6%9E%90CSS-BOeiL59G.png" alt="预解析器解析CSS"></p><p>我们来看一下 <strong>主线程</strong> 是怎么处理的，<strong>渲染主线程</strong> 是非常繁忙的，它有这么多的 <code>HTML</code> 字符串需要解析，一行一行地读，一行一行地生成 <code>DOM</code> 对象结构，它已经够忙了，事情比较多，所以说它需要有另一个线程来帮助它处理一些事情，像这个 <code>CSS</code> 解析，需要其它线程帮助它处理一下，帮它解析完后交回给 <strong>渲染主线程</strong> 就行了，<strong>渲染主线程</strong> 就会生成一个 <strong><code>CSSOM</code>树</strong>。</p><p>于是，浏览器就会启动另外一个线程，这个线程就叫做 <strong>预解析线程</strong>，率先去下载和解析 <code>CSS</code>。</p><p>所以说，<strong><code>CSS</code> 代码不会耽误 <code>HTML</code> 的解析，或者说不会阻塞 <code>HTML</code> 的解析</strong>。</p><p>但是，<strong><code>CSS</code></strong> 的加载会 <strong>堵塞</strong> <strong>下一步</strong> 中的 <strong>样式计算 <code>Recalculate Style</code></strong>。所以无论 <strong><code>DOM</code>树</strong> 是否已经完成，它都必须等待到 <strong><code>CSSOM</code>树</strong> 构建完成，即 <strong><code>CSS</code></strong> 加载完成（或 <code>CSS</code> 加载失败）后，才能开始 <strong>样式计算 <code>Recalculate Style</code></strong>。</p><p>所以，<strong><code>CSS</code> 会堵塞页面的显示（渲染）</strong>。</p><p>那么，<strong><code>css</code></strong> 会不会阻塞 <strong><code>js</code></strong> 执行？</p><p><strong><code>JS</code></strong> 的作用在于修改，它帮助我们修改网页的方方面面：内容、样式以及它如何响应用户交互。这 “方方面面” 的修改，本质上都是对 <strong><code>DOM</code>树</strong> 和 <strong><code>CSSDOM</code>树</strong> 进行修改。当在 <strong><code>JS</code></strong> 中访问了**<code>CSSOM</code>树** 中某个元素的样式，那么这时候就需要等待这个样式被下载完成才能继续往下执行 <code>JS</code> 脚本。</p><p>所以，<strong><code>CSS</code> 会堵塞 <code>JS</code> 的执行</strong>。</p><h5 id="_2-html-解析遇到-js-代码怎么办" tabindex="-1"><a class="header-anchor" href="#_2-html-解析遇到-js-代码怎么办"><span>（2）<code>HTML</code> 解析遇到 JS 代码怎么办？</span></a></h5><p>我们先回到一开始解析 <code>HTML</code> 的流程图：</p><p><img src="/web-docs/assets/%E8%A7%A3%E6%9E%90HTML-BKmY1GX2.png" alt="解析HTML"></p><p>解析后，<code>DOM</code> 元素有了，<code>CSS</code> 也有了，那 <code>JS</code> 呢？<code>JS</code> 为什么不生成树呢？因为 <code>JS</code> 代码只需要执行一遍就行了。后续的步骤就根本用到解析了。</p><p>为什么第一步要生成两颗树？是因为后续的流程需要用到，但是 <code>JS</code> 在后续的流程中用不到。所以，<strong>渲染主线程</strong> 遇到 <code>JS</code> 代码 <strong>直接运行</strong> 就完事了。</p><p>在浏览器的事件循环中，一开始就会执行全局代码，执行完全局代码就完事了。如果后面有事件注册那些事件，那就交给其他线程去监听就完事了。</p><p><strong>渲染主线程</strong> 遇到 <code>JS</code> 代码 的流程如下图所示：</p><p><img src="/web-docs/assets/%E9%A2%84%E8%A7%A3%E6%9E%90%E5%99%A8%E8%A7%A3%E6%9E%90JS-Dy44ddeL.png" alt="预解析器解析JS"></p><p>同样的，<strong>渲染主线程</strong> 仍然需要一个 <strong>预解析器线程</strong> 优先去下载，因为有些外部的资源，需要先把它下载下来，但是这里不一样的地方在于：</p><p>当 <strong>渲染主线程</strong> 遇到 <code>JS</code> 时 <strong>必须暂停一切行为</strong>，等待下载执行完成后才能继续预解析线程可以分担一点下载 <code>JS</code> 的任务。</p><p>比方说，<strong>主线程</strong> 从上往下走，到了某一行的时候，发现一个 <code>script</code> 标签元素，因为已经有个预解析线程在优先下载 <code>js</code> 了，但还没下载完成，如果是 <code>CSS</code>，<strong>主线程不会等待</strong>，直接往下执行，但是这个是 <code>JS</code>，那么 <strong>主线程就会暂停等待 <code>js</code> 下载完成</strong>，等待下载完成后，把这个代码放到 <strong>主线程</strong>，然后启动 <strong>V8 引擎</strong> 去运行 <code>js</code>。运行完了之后才能继续 <strong>解析 <code>HTML</code></strong>。</p><p>为什么要这样做？为什么不能像 <code>CSS</code> 那样提高解析效率？是因为 <code>js</code> 代码里边有可能会改动当前的 <code>DOM</code>。就是这个 <code>js</code> 代码有可能把这个解析出来的 <code>DOM</code> 改动了。这个 <code>DOM</code> 元素并不是解析完 <code>HTML</code> 才生成的，而是 <strong>一边解析一边生成的</strong>。</p><p><strong>这也是为什么 <code>Javascript</code> 文件要写在 <code>body</code> 底部的原因</strong>。</p><p>好了，这里总结一下 <strong>第一个步骤</strong>：</p><p>把一个 <code>HTML</code> 字符串放到我们 <strong>渲染流水线</strong> 中的 <strong>第一步</strong> 进行解析，然后它会产生两棵树：分别是 <strong><code>DOM</code>树</strong> 和 <strong><code>CSSOM</code>树</strong>。目的是 <strong>给后续步骤做准备</strong>，并且开放 <code>JS</code> 操作 <code>DOM</code> 和 <code>CSS</code> 的能力。浏览器的 默认样式、内部样式、外部样式、行内样式均会包含在 <strong><code>CSSOM</code>树</strong> 中。</p><h4 id="_2-样式计算-recalculate-style" tabindex="-1"><a class="header-anchor" href="#_2-样式计算-recalculate-style"><span>2. 样式计算 - Recalculate Style</span></a></h4><p>到了第二步，<strong>第二步骤</strong> 中就可以拿到 <strong>第一个步骤</strong> 中生成的两颗树，但是光有这两颗树还不够，还得知道这个 <strong><code>DOM</code> 树</strong> 里边每一个节点到底是受那些样式的影响，它最终的样式又是什么。所以，这一步骤就叫 <strong>样式的计算</strong>。</p><p>样式计算流程如下图所示：</p><p><img src="/web-docs/assets/%E6%A0%B7%E5%BC%8F%E8%AE%A1%E7%AE%97%E6%B5%81%E7%A8%8B-DiE_aOjm.png" alt="样式计算流程"></p><p>经过计算过后，还是那颗 <strong><code>DOM</code>树</strong>，不过现在 <strong><code>DOM</code>树</strong> 的每个节点上面就有 <strong>最终的样式</strong> 了，其实也可以叫 <strong><code>render</code>树</strong>。</p><p><code>CSS</code> 里边有两块很重要的知识，一块是 <strong><code>CSS</code> 属性值的计算过程</strong>，另一块就是 <strong>视觉可视化模型</strong>。</p><p>这两块重要的知识都是发生在这一步骤里边的。</p><ul><li><strong><code>CSS</code> 属性值的计算过程又包含很多内容</strong>： <ul><li><strong>层叠</strong>（比较粗糙的说法就是：权重、优先级）。层叠就是用规则来解决冲突的，就是样式有重复怎么来渲染。</li><li><strong>继承</strong>。</li><li>....</li></ul></li><li><strong>视觉可视化模型</strong>： <ul><li><strong>盒模型</strong>。</li><li><strong>包含块</strong>（里边包括了流式布局、浮动布局、flex 布局、包含 BFC 等，都包含着里边了）。</li><li>....</li></ul></li></ul><p><strong>样式计算的最终目的就是得到 DOM 每个节点的最终样式</strong>。那么，什么是 <strong>最终样式</strong>？严格的说，应该叫 <strong>计算后的样式</strong>（Computed Style）。</p><p>注意，这里每个 DOM 节点的最终样式并不是我们在样式表里写的样式，比方说我写了以下的一个样式：</p><div class="language-css line-numbers-mode" data-highlighter="shiki" data-ext="css" data-title="css" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#ABB2BF;">    color</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">red</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的代码中，是我们写的样式，但它不一定是最终样式。因为还有很多情况，就颜色来说，你光写了 <code>color: red</code> 就是 <code>div</code> 的最终样式吗？万一别的地方也选中了它，给它设置为别的颜色怎么办呢？又比方说它有继承，它最终的颜色又是什么呢？</p><p>所以，什么是 <strong>计算后的样式</strong>？其实就是 <strong>最终样式</strong>，就是它所有的 <code>CSS</code> 属性必须要全部有值。如下图所示：</p><p><img src="/web-docs/assets/CSS%E5%B1%9E%E6%80%A7%E5%85%A8%E9%83%A8%E6%9C%89%E5%80%BC-DfUoJm2S.png" alt="CSS属性全部有值"></p><p>计算后的结果会和我们写的样式不同，比方说我们设置了以下样式：</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAh0AAABdCAYAAAABp9SiAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAEnQAABJ0Ad5mH3gAAAi/SURBVHhe7d1PbtvGAsDh3MQ36PJdIUcx0G56hqy7SXOHLrwoHPQEWaRBFikCPCSrooARIEBjb4ICzeqBT5wZSvwzpEhZGtP29wGD2KIsUTGQ+WVIiU9evXpVff36NYz/fvpftc/19XX14cOH6u3bt9WbN28MwzAe/Kj/vav/3av//ePhevbsWfX06dPB4DjqzlgcHQAAS4kOAKAI0QEAFCE6AIAiRAcAUEQ2OgzDMAzDMI49stEBAHBsogMAKEJ0AABFiA4AoAjRAQAUITqoqj9eVGdnZ5vxonqXbgKAYztudPx7Vb2+uKgu0vh4k25nsZsPu7/Hi9+vqm/p9uN7V73YBMeLP9K3AHAix42OrZvq46qjo8D+hQB7XV39m74/0Ler16eNjs+X1bkVDgAKEB2ncl+iIxxaER0AnN7i6Ogs+1983EzfOROTeu8QzOur3XQaJtgPV9XV73Hbx5v4OBe9yXtqH+Jj3MQ/m/tsvo+ax8uM7X3m6e5D63X0Xt/wPt/i6+s/383HzX2Gf59T0THvd7GH6ACgkEXRESa51gQYJ/bcZDcSHWlC3t0e79dM2E0o1NvjhFrHRpykm/vs24dtbDST+uA5axNRNMNUCGxNrXQMAqP7GtvGnmv+72Lal5fn1dlzyQHA6S2Ijnqi7k+iY5N3/vYwMfb+h9+eVNtfh0k13bf+Ok7I+/dhOEnnJvSx/Z4nTvAjQdGYio7+80/cd/h6avv/HvZK71g5f/kl3QAApzU/OtKKwW45fzeGE11+AoyrF5kxNzpm7EOJ6KjF8GieP7PCMBkd6efT62t/3Td8PRuLfhfTrHQAUMr86Mj+73pMflKfmlxr7Ql2/kpH13CSPk10tIV9zYbBxL6G7XWs1Pu3J076j73od7GHczoAKGRBdIxMrlkjk3r6H/rYZL8/Ovbvw7zoiLdNBdBuNWH/eRLjYdB/3q7wujbBMTfE2ub/LvYQHQAUsig6amGyC5NxM3aTcpggO9vi6Ey8mUMDzfY50VHbuw97o2Ojvx/9iX8iOqaevyOcMLq732Af0vZhhMVgaf9sHN3nmb0fU0QHAIUsjg6OaORtskX5cDAAChEdd+a455UczsegA1CG6CitdVhncLjlrqS3zzrMAsApiQ4AoAjRAQAUIToAgCJEBwBQhOgAAIoQHQBAEaIDAChCdAAARawuOv757Yfqz/98l8YP1ee/04Z75Obnet9/utuPN58hXNb+7Kw6f/kl3bLTbIvjvLr8nDYAwIHWFR3vfzptaPz9a/VXgZBZf3R8qS6/r2PjMnwE+iA66uuxfH+5uVcUA8SnlQJwO6uKjrDK8eOv1T/p+6MrFB1rV0dEvNZKvO5KbqWjy/VZALi9exQd76tP28Mu/ZWE6+rzj99Vn97HP5v7fHqfNofYaP/sbvz123W60xzdx6/H9jk2uoeGMisdYSWn+/ODlZ3evub3L0bAWWs14jC3iY64WrI9BNPel/paLpvvL5/Hbecv323v2w+X5jCOoAF4+FYQHcOJfDt+bmb0GBztCThO8M3EvnuMJgK625NbrnSEwybbfZoQ4mL/4ZX68TpRkYJjFzLD1x2VjY7h4ZUUHM93t7yrA6PZn3QBufpx21ER7tP6mZroAHg8VhAdO6MrHdlJPE7IcYKO0TGcwHOrCLeMjhkxMSc6wmvtBczobSc75DQjOurzO/r3Cbf1zvEIt6UTTkN0xO0hKlKMhK970QHA43EvoiN/ezs0jhMd4Xk2IbMdmX2J4TG+PdgXHWE/hts7j90edxUdKTgGobC9FH5/iA4Axt2L6FjLSkdXOqSTO9wyGR31z+X3Ibz+OYdvjmYqOtIhnFwk5FY62kQHABn3Izoy5zaEVYHtfWdGx+g5EocJ+7AwOuqfGX3+sM/dk1PzUhCc7JyOdM7G6OMPz+noWBAd4bbR8AHgIbkn0bGRJuT8IYe50bERgmD3OPMDJK1stH42tw+d7WG09qH33M0Y7vfE9uCW0TF2eCQFQRMCg9F5vt67V9rbl6x0NPty6GsB4N5YVXTwGB1r1QaAtRMd3K200uEtswAPn+jgjuwOzwgOgMdBdAAARYgOAKAI0QEAFCE67sjVL78sHgBwn4mOO1JHxPXTp7OH6ADgvnsw0dG9bsrEdU9WoomO6smTvaNcdMR3lPh0UABO4cFEx9bkdU/WQ3QA8NiIjjsiOgB4bFYVHf1Lu3evORIv1rb3EMpEdHQPweQev75OSvsaKrmrwR7nY7uPER3ba5m0r6Uydm2TNAYfxNVcvr41htHho8oBuL3VREf3qrF9w6vDxoDIxMVIdAzv33/MXdQ0t+UvQLey6Aih0FxmPu7bNixCcJxXl5/T9ykwttv734+udIgOAG5vHdExdkXYRjYkYiQMLgOfvW/mKrQb3agYhs0pD9UcLzqa4Kh1o+Hd82FA1Ld1ribbWRlxeAWA01lHdOyZ3PMrDvmQODxQRu5zIkeLjtHVhxgQ7cMm25FCox0gkegA4HTWER0rWul4ONGRX+loEx0AlLSO6EhRsOScjtFzQEZWTQbndITQaUfG3OhY2TkdU/vRP6ejL2xvDs/sVkaG0ZFec+dQDgAss5LoqLXfNdI9oTNIkbDd3gmO4c/G0V096b87phsYdxMdc8dB0VHrvXulHu13sITVjnR7HRv51ZFdkAze/QIAM60oOh6XOiKWjrsUAkd0AHALooMZ0krHLVd3AHjcRAfTmsMzggOAWxIdAEARogMAKEJ0AABFiA4AoIhl0bH9zIeJD5wCAMhYFh3JrA+lAgBoOSg64iXRfSQ2ADCf6AAAihAdAEARh0VHuuiZ63AAAHMdGB1RvEKpFQ8AYL8Do8NKBwCwzGHR4ZwOAGAh0QEAFCE6AIAiRAcAUMRB0eFj0AGApZZFhwu+AQAHWhYdAAAHEh0AQBGiAwAoQnQAAEWIDgCgCNEBABSRjQ7DMAzDMIxjj2x0AAAcm+gAAIoQHQBAEV+/fq3+D3PAzNJA6OzRAAAAAElFTkSuQmCC" alt="css样式"></p><p>那么通过计算转换后，发现对应的属性值和单位并不相同：</p><p><img src="/web-docs/assets/css%E8%BD%AC%E6%8D%A2%E5%90%8E%E7%9A%84%E9%A2%9C%E8%89%B2-BM_uO7Qh.png" alt="css转换后的颜色"></p><p>![css 转换后的字体大小](assets/css 转换后的字体大小.png)</p><p>所以说，这一步骤会做很多事情，该继承的继承、该转换单位的转换单位 等等。</p><p>好了，这里总结一下 <strong>第二个步骤</strong>：</p><p>最终得到的还是一个 <strong><code>DOM</code>树</strong>，只不过这个 <strong><code>DOM</code>树</strong> 里边的每一个节点都有最终样式。</p><p>但是，现在能看见页面吗？还早得很，要看到界面必须要生成像素点。</p><h4 id="_3-布局-layout" tabindex="-1"><a class="header-anchor" href="#_3-布局-layout"><span>3. 布局 - Layout</span></a></h4><p>布局的流程如下图所示：</p><p><img src="/web-docs/assets/%E5%B8%83%E5%B1%80%E6%B5%81%E7%A8%8B-CPZvBfAq.png" alt="布局流程"></p><p>这一步生成的结果很简单，就是整个 <strong><code>DOM</code>树</strong> 里边，根据每一个节点的 <strong>最终样式</strong> 算出每一个节点的 <strong>尺寸和位置</strong>。结果很简单，但是过程很复杂。</p><p>页面上的元素，它们之间的位置和尺寸是相互影响的。一个元素的位置和尺寸变化了，可能就会导致整个布局发生变化。</p><p>在这个 <strong>布局流程</strong> 的结果里边，需要说两个东西，一个东西是 <strong>尺寸</strong>，也就是宽高。另一个东西是 <strong>位置</strong>，位置是什么位置，是相对谁的位置？它的位置相对的是 <strong>包含块</strong>。</p><p><strong>包含块</strong> 在 <strong>视觉可视化模型</strong> 里边是一个很重要的知识，这里简单来说一下，就是一个元素的活动区域。</p><p>比方说一个父元素，它里边有子元素，子元素的 <code>margin</code> 相对的是它的父元素，那么这个父元素就是这个子元素的 <strong>包含块</strong>。这是一个很粗糙的说法，具体详细的这里不展开说明。</p><p>有的人可能会问，在第二步种的 <strong>样式计算</strong> 中，难道不会计算宽高吗？其实是不会的，有些宽高能算出来，比方说绝对值的宽高能算出来，但有些宽高，比方说 <strong>百分比</strong>、<code>auto</code> 这些值是算不出来的，只有在 <strong>布局阶段</strong> 才能算出来。</p><p>布局得到的结果，也就是输出的这个 <strong><code>Layout</code>树</strong>，跟输入的 <strong><code>DOM</code>树</strong> 是不一样的，有些节点少了，有些节点多了。为什么会产生差异呢？这就涉及到 <code>CSS</code> 了，可能会有如下的情况：</p><p>（1）有些隐藏的元素，它是不会出现在 <strong>布局树</strong> 里边，为什么呢？<strong>布局树</strong> 是要能够找到每个节点的 <strong>几何信息</strong>，什么叫 <strong>几何信息</strong>？就是 <strong>尺寸和位置</strong>。所以有些隐藏的节点，像这种使用了 <code>display: none</code> 的节点，它是没有几何信息的。如下图中：</p><p>![Layout树 和 DOM树 的差异](assets/Layout树 和 DOM树 的差异.png)</p><p>（2）还有一种情况，就是涉及到 <strong>伪元素</strong>，比方说一个元素设置了 <strong>伪元素</strong> <code>::before</code>，设置了之后，<code>::before</code> 在 <strong><code>DOM</code>树</strong> 里边是不存在的，但是在 <strong>布局树</strong> 里边是存在的。它是有自己的 <strong>几何信息</strong> 的，如下图所示：</p><p>![Layout树 和 DOM树 的差异 - 伪元素](assets/Layout树 和 DOM树 的差异 - 伪元素.png)</p><p>（3）还有一种情况，就是 <code>div</code> 元素里边包含了 <code>p</code> 元素，还包含了一个文本字符，如下图所示：</p><p>![Layout树 和 DOM树 的差异 - 匿名元素](assets/Layout树 和 DOM树 的差异 - 匿名元素.png)</p><p>我们发现生成的 <strong>布局树</strong> 中，多出了节点，这是为什么呢？因为，这都是 <strong>布局的规则</strong>，在这个 HTML 字符串中，这个 b 字符串是内容，有这么一个规则：</p><ol><li>就是 <strong>内容必须在 行盒 中</strong>。</li><li><strong>行盒</strong> 和 <strong>块盒</strong> 不能相邻。</li></ol><p>这个规则怎么理解呢？</p><div class="language-html line-numbers-mode" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 这是一个块盒 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 第一点中，内容 a 必须在一个 行盒 中 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 但是这里却发生了内容 a 在一个 块盒 中 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 那么怎么办呢？它会在 布局树 里边，在 p 元素的内的 a 内容外层包裹一个 行盒，这个 行盒 就叫做 匿名行盒 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;a&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- b 是内容，内容是 行盒，它是不能和 块盒 相邻的 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 但是，这里也发生了，那么怎么办呢？ --&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 它会在 布局树 里边，在 b 内容的外层，包裹一层 块盒，这个 块盒 就叫做 匿名块盒 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 然后 内容b 在 匿名块盒 中，也不满足规则，还需要在这个 匿名块盒 的里层，再创建一个 匿名行盒，然后把 内容b 放到这个 匿名行盒 中，但是上图省略了这一步骤 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    b</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">    &lt;!-- 这也是一个块盒 --&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;c&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#E06C75;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>注意：这里的 <strong>行盒</strong>，可不是什么 <strong>行级元素</strong>、<strong>块级元素</strong>，这都是很久之前的说法了，W3C 的官网已经找不到这样的说法了。而且明确的说，这个 <strong>行级元素</strong> 和 <strong>块级元素</strong> 的 说法已经过时了，不应该使用这样的说法了。现在都叫 <strong>行盒</strong>、<strong>块盒</strong>。</p><p>为什么呢？因为 <strong>行级元素</strong> 和 <strong>块级元素</strong> 指的是 <strong><code>HTML</code></strong>，因为它说到 元素 了，<strong>行盒</strong> 和 <strong>块盒</strong> 说的是 <strong><code>CSS</code></strong>。</p><p>盒子的 <strong>类型</strong> 由 <code>CSS</code> 来决定，不由 <code>HTML</code> 来决定。<code>HTML</code> 只提供语义化标签。</p><p>这里可能会有一个误解：在上图中，可能会有人觉得在 <strong><code>DOM</code>树</strong> 中，<code>div</code> 是一个 <code>DOM</code>，那么在 <strong><code>Layout</code>树</strong> 中，<code>div</code> 也是一个 <code>DOM</code>，其实不是的。其实在 <strong>布局树</strong> 里边，每一个节点都对象，但不是 <code>DOM</code> 对象，它是一个 <code>c++</code> 对象，是 <code>JS</code> 获取不到的。</p><p>布局在对 <code>js</code> 而言，虽然获取不到 <strong>布局树</strong> 里边的对象，但它可以间接地获取一些信息。比方说我们平时用的 <code>doucment.body.clientWidth</code> 就是获取的 <strong>布局树</strong> 里边的信息。</p><h4 id="_4-分层-layer" tabindex="-1"><a class="header-anchor" href="#_4-分层-layer"><span>4. 分层 - Layer</span></a></h4><p>到了第四步，我们就从第三步中拿到了一个 <strong>布局树</strong>，<strong>布局树</strong> 里边有各种节点的 <strong>几何信息</strong>，宽高、尺寸以及位置都有了。</p><p>那是不是就应该开始 <strong>画</strong> 页面了，但是这一步却没有这么做，为什么呢？是因为浏览器考虑到，需要进行一个优化，什么优化呢？就是这个页面一旦把它画出来了，它这个页面不是永远静止的，它又不是一张图片。用户是会进行操作的，随着用户的操作，这个浏览器会发生很多的变化，包括一些动画造成的变化，包括一些 <code>js</code> 造成的变化。</p><p>那一旦变化了，浏览器就得把页面重新 <strong>画</strong> 一遍，而且是完全重新画一遍，这个工作量太大了。能不能提高一下效率呢？其实是可以的，怎么做呢？其实就是 <strong>分层</strong>。</p><p><strong>分层</strong> 这个步骤其实以前的浏览器中是没有的，现代的浏览器里边就都有了。那么这个分层到底是怎么做的呢？其实它很简单，它其实就非常类似于 Photoshop 里边的图层。</p><p>主线程会使用一套复杂的策略对整个 <strong>布局树</strong> 中进行 <strong>分层</strong>。</p><p><strong>分层</strong> 的好处在于，将来某一个层改变后，仅会对该层进行后续处理，从而提高效率。</p><p>分层的的流程如下图所示：</p><p><img src="/web-docs/assets/%E5%88%86%E5%B1%82-ogHD9dku.png" alt="分层"></p><p>其实，我们在浏览器的调试工具中就可以查看页面的 <strong>分层</strong>，如下图所示：</p><p><img src="/web-docs/assets/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%88%86%E5%B1%82-BniLK8d5.png" alt="浏览器分层"></p><p><img src="/web-docs/assets/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%88%86%E5%B1%82%E7%9A%84%E6%93%8D%E4%BD%9C-CrLK8f3z.png" alt="浏览器分层的操作"></p><p>其实我们在写代码的时候，有些属性会影响到它的分层决策。但不是一定的，比如说你写的这个属性，它不一定会单独分出一层来，只能说有影响。</p><p>其实说白了就是 <strong>堆叠上下文</strong> 有关的属性，跟 <strong>堆叠上下文</strong> 有关的属性就会影响到 <strong>分层</strong> 的 <strong>结果</strong>。但只是影响 <strong>分层</strong> 的 <strong>决策</strong>，并不是直接形成 <strong>分层</strong> 的 <strong>结果</strong>。</p><p>什么是 <strong>堆叠上下文</strong> 就不展开了，简单来说就是跟一些属性有关，比方说：<code>z-index</code>、<code>opacity</code>、<code>transform</code> 等。</p><h4 id="_5-绘制-paint" tabindex="-1"><a class="header-anchor" href="#_5-绘制-paint"><span>5. 绘制 - Paint</span></a></h4><p>这里的 <strong>绘制</strong>，不是生成像素点，而是为 <strong>每一层</strong> 生成如何 <strong>绘制的指令</strong>。绘制流程如下图所示：</p><p><img src="/web-docs/assets/%E7%BB%98%E5%88%B6-BZ_3wrLX.png" alt="绘制"></p><p>那么什么是 <strong>绘制的指令</strong>？</p><p>用大白话文来说：就是将画笔移动到坐标点为 (x, y) 的位置，画一个 width * height 的矩形。然后用 xx 颜色填充矩形。然后又将画笔移动到其他坐标点的位置继续画其它的内容。</p><p>这就有点像 <code>Canvas</code>，<code>Canvas</code> 就跟这里的 <strong>绘制指令</strong> 基本相似。我们用的 <code>Canvas</code> 的那个 <strong>画</strong>，其实用的就是浏览器内核里边的绘制功能。所以，我们可以直接在 <code>Canvas</code> 上直接绘制，我们写的 <code>Canvas Html</code> 只不过是浏览器给你解析完成了之后生成 <strong>布局树</strong>，然后 <strong>分层</strong>，然后再帮你绘制。</p><p>到了 <strong>绘制</strong> 之后，<strong>渲染主线的工作就到此为止了，剩余步骤交给其他线程完成</strong>。</p><p>如下图所示：</p><p><img src="/web-docs/assets/%E7%BB%98%E5%88%B6%E8%BF%87%E5%90%8E-CU_guUnc.png" alt="绘制过后"></p><p>为什么主线程不再继续工作？这是浏览器做的最大的优化，后续步骤中会说明。这里的 <strong>其他线程</strong> 其实涉及到很多线程，这里只讲重点核心的线程。</p><h4 id="_6-分块-tiling" tabindex="-1"><a class="header-anchor" href="#_6-分块-tiling"><span>6. 分块 - Tiling</span></a></h4><p>从这里开始就是其他线程的工作了，分块的流程如下图所示：</p><p><img src="/web-docs/assets/%E5%88%86%E5%9D%97-BW1OA07u.png" alt="分块"></p><p>通过第五步的 <strong>绘制</strong> 后，<strong>布局树</strong> 的每一层都有对应的 <strong>绘制指令</strong>，<strong>分块</strong> 是将每一层分为很多的小区域，如上图的右侧所示。</p><p>那么，为什么要把每一层都划分小区域呢？因为每一层有可能会很大，每一层的东西可能很多，那么到时候在 <strong>画</strong> 的时候就会有一个优先级，会先画那些靠近 <strong>视口位置</strong> 的小块**。分块** 主要起这么一个作用：为了提高效率。</p><p><strong>分块</strong> 的逻辑如下图所示：</p><p><img src="/web-docs/assets/%E5%88%86%E5%9D%97%E7%9A%84%E9%80%BB%E8%BE%91-Di_easMn.png" alt="分块的逻辑"></p><p>当 <strong>主线程</strong> 产生了 <strong>绘制指令</strong> 之后，就会交给另一个线程，这个线程叫做 <strong>合成线程</strong>，<strong>合成线程</strong> 其实也在 <strong>渲染进程</strong> 里边，<strong>渲染进程</strong> 可能我们目前只了解到 <strong>渲染主线程</strong>，其实它还有很多线程的。</p><p><strong>合成线程</strong> 主要是进行 <strong>分块</strong> 操作的，它其实就是一个指挥命令的人，它又会启动更多的其他线程，如上图中的 <strong>分块器</strong>。让 <strong>分块器</strong> 帮助 <strong>合成线程</strong> 进行 <strong>分块</strong>。</p><h4 id="_7-光栅化-raster" tabindex="-1"><a class="header-anchor" href="#_7-光栅化-raster"><span>7. 光栅化 - Raster</span></a></h4><p><strong>光栅化</strong> 是将每个 <strong>小块</strong> 变成 <strong>位图</strong>，<strong>优先处理靠近视口的小块</strong>。这里的 <strong>位图</strong> 就是每个像素点的信息了。可以把 <strong>位图</strong> 理解成就是内存里边的一个二维数组，这个二维数组记录了每个像素点的颜色。</p><p>光栅化的流程如下图所示：</p><p><img src="/web-docs/assets/%E5%85%89%E6%A0%85%E5%8C%96-C7xEBgEX.png" alt="光栅化"></p><p>光栅化的具体过程如下图所示：</p><p><img src="/web-docs/assets/%E5%85%89%E6%A0%85%E5%8C%96%E7%9A%84%E9%80%BB%E8%BE%91-CGE84uox.png" alt="光栅化的逻辑"></p><p><strong>合成线程</strong> 在 <strong>光栅化</strong> 的时候，会把对应的工作交给 <strong>GPU进程</strong>，当然了，<strong>GPU进程</strong> 里也有很多的线程，这里简单地用 <strong>GPU进程</strong> 来概括了。然后把 <strong>光栅化</strong> 最终生成的一块一块的 <strong>位图</strong> 交回给 <strong>合成线程</strong>。</p><p>此过程会用到 <strong>GPU</strong> 加速，也会用到显卡。 <strong>GPU</strong> 的运算速度是要高出 <strong>CPU</strong> 很多很多的。</p><p><strong>GPU</strong> 会提高 <strong>光栅化</strong> 的运算速度。</p><p>那可能有人会问，那为什么不全部都用 <strong>GPU</strong>，而要用 <strong>CPU</strong> 呢？主要的原因是 <strong>GPU</strong> 它能干的事，<strong>CPU</strong> 也都能干，只是慢一点，但是 <strong>CPU</strong> 能干的事，<strong>GPU</strong> 就不一定能干了。<strong>GPU</strong> 的功能范围小一点。它只做跟显示相关的一些运算。</p><h4 id="_8-画-draw" tabindex="-1"><a class="header-anchor" href="#_8-画-draw"><span>8. 画 - Draw</span></a></h4><p><strong>合成线程</strong> 计算出每个 <strong>位图</strong> 在屏幕的位置，交给 <strong>GPU</strong> 进行最终呈现，如下图所示：</p><p><img src="/web-docs/assets/%E7%94%BB-DdjlGafz.png" alt="画"></p><p>但是，在画之前需要先确定一个东西：<code>quad</code>。这个 <code>quad</code> 是 <strong>指引信息</strong>，什么叫 <strong>指引信息</strong> 呢？就是它告诉你每个 <strong>块</strong> 的 <strong>位图</strong> <strong>相对于屏幕在哪</strong>。跟之前的布局不一样，布局是相对于整个页面，而这里是相对于屏幕的位置在哪。</p><p>这个 <code>quad</code> 会告诉你该 <strong>画</strong> 哪个地方，先 <strong>画</strong> 哪个位置，再 <strong>画</strong> 哪个位置，依次把位图 <strong>画</strong> 出来。它根据分层结构要去计算一下。以及会考虑到旋转、缩放等形变。形变发生在 <strong>合成线程</strong>，与 <strong>渲染主线程</strong> 无关，<strong>这就是 <code>transform</code> 效率高的本质原因</strong>（使用 transform 做动画的原因）。</p><p><strong>合成线程</strong> 会把确定好的 <code>quad</code> 交给 <strong>GPU进程</strong>，<strong>GPU进程</strong> 再交给真实的硬件显卡，最终显卡就会把这些像素信息按照它的位置就呈现出来了。</p><h3 id="完整过程总结" tabindex="-1"><a class="header-anchor" href="#完整过程总结"><span>完整过程总结</span></a></h3><p><img src="/web-docs/assets/%E5%AE%8C%E6%95%B4%E8%BF%87%E7%A8%8B-DyuPx85C.png" alt="完整过程"></p><h3 id="reflow" tabindex="-1"><a class="header-anchor" href="#reflow"><span>Reflow</span></a></h3><p><img src="/web-docs/assets/reflow-JvcC9ilM.png" alt="reflow"></p><p>在一个已经画完并渲染好的页面中，在我们的页面代码里边，比方有些时候用 <code>js</code> 去修改样式，比方说把宽度进行了修改，这里修改的是 <strong>渲染流程</strong> 里边的谁？其实修改的是 <strong><code>CSSOM</code> 树</strong>。当我们去修改一些跟几何尺寸相关的信息的时候，修改的是 <strong><code>CSSOM</code>树</strong>、也有可能是 <code>DOM</code>。比方说我们添加了一个 <code>DOM</code> 元素，<code>DOM</code> 元素增加了，就会影响到布局的 <strong>布局信息</strong>。</p><p>当我们修改了会影响 <strong>布局信息</strong> 的内容的时候，它就会启动一系列的重新计算，也就是重新进行一遍 <strong>渲染流程</strong>。这个过程就叫 <code>reflow</code>。</p><p>为了避免连续的多次操作导致 <strong>布局树</strong> 反复计算，浏览器会合并这些操作，当 <code>JS</code> 代码全部完成后再进行统一计算。所以，改动属性造成的 <code>reflow</code> 是 <strong>异步</strong> 的。</p><p>也同样因为如此，<strong>当 <code>JS</code> 获取布局属性时，就可能造成无法获取到最新的布局信息</strong>。</p><p>浏览器在反复权衡下，<strong>最终决定获取属性立即 <code>reflow</code></strong>。</p><h3 id="repaint" tabindex="-1"><a class="header-anchor" href="#repaint"><span>Repaint</span></a></h3><p><img src="/web-docs/assets/repaint-BIt6D9yp.png" alt="repaint"></p><p><code>repaint</code> 的本质就是重新根据 <strong>分层</strong> 信息计算了 <strong>绘制指令</strong>。当改动了可见样式后，就需要重新计算，会引发 <code>repaint</code>。</p><p>比方说：改动了字体颜色、背景颜色等 <strong>跟几何信息无关</strong> 的东西，就可以跳过上图中的 <code>layout</code> 步骤。甚至 <strong><code>layer </code>分层</strong> 都可以跳过，但得看具体情况。如果说你影响到了它的 <strong>分层</strong> 层次的话，它可能就不会跳过 <code>layer</code>，还是需要重新 <strong>分层</strong>。</p><p>但是无论如何 <strong><code>paint</code> 绘制</strong> 阶段是不可能跳过的，必须要重新产生 <strong>绘制指令</strong>，先画什么，需要填充什么颜色等等...</p><p>由于元素的 <strong>布局信息</strong> 也属于可见样式，所以 <code>reflow</code> 一定会引起 <code>reapint</code>。</p><h3 id="面试题" tabindex="-1"><a class="header-anchor" href="#面试题"><span>面试题</span></a></h3><h4 id="在浏览器的地址栏输入一个地址-按下回车后发生了什么事" tabindex="-1"><a class="header-anchor" href="#在浏览器的地址栏输入一个地址-按下回车后发生了什么事"><span>在浏览器的地址栏输入一个地址，按下回车后发生了什么事?</span></a></h4><p>首先浏览器的 <strong>网络线程</strong> 会对输入的地址进行解析，因为浏览器并不能直接通过域名找到对应的服务器，而是要通过 IP 地址。所以会先通过域名查找 IP 地址，然后在确定目标服务器服务器的IP地址后，则经历三次握手建立 TCP 连接，当建立 TCP 连接之后，就可以在这基础上进行通信，浏览器发送 http 请求到目标服务器。当服务器接收到浏览器的请求之后，就会进行逻辑操作，处理完成之后返回一个 HTTP 响应消息。浏览器的 <strong>网络线程</strong> 接收到 <code>HTML</code>、<code>CSS</code>、<code>JS</code> 等页面文件后，会生成一个 <strong>渲染任务</strong>。然后给到了 <strong>消息队列</strong>，等待 <strong>渲染主线程</strong> 进行渲染。当 <strong>渲染主线程</strong> 拿到 <strong>渲染任务</strong> 后，就会启动 <strong>渲染流程</strong>。</p><p>流程如下一个标题的内容所示。</p><p>当数据传输完毕后，TCP 链接则会经过四次挥手完成断开。</p><h4 id="浏览器是如何渲染页面的" tabindex="-1"><a class="header-anchor" href="#浏览器是如何渲染页面的"><span>浏览器是如何渲染页面的？</span></a></h4><p>当浏览器的网络线程收到 HTML 文件后，会产生一个渲染任务，并将其传递给渲染主线程的消息队列。在事件循环机制的作用下，渲染主线程取出消息队列中的渲染任务，开启渲染流程。</p><p>整个 <strong>渲染流程</strong> 分为多个阶段，分别是 <strong>HTML 解析</strong>、<strong>样式计算</strong>、<strong>布局</strong>、<strong>分层</strong>、<strong>绘制</strong>、<strong>分块</strong>、<strong>光栅化</strong>、<strong>画</strong>。每个阶段都有明确的输入输出，<strong>上一个阶段的输出会变成下一个阶段的输入</strong>。这样，整个渲染流程就形成了一套组织严密的生产流水线。</p><p>（1）渲染的第一步是解析 HTML。</p><p>解析过程中遇到 CSS 解析 CSS，遇到 JS 执行 JS。为了提高解析效率，浏览器在开始解析前，会启动一个预解析的线程，率先下载 HTML 外部的 CSS 文件和 外部的 JS 文件。</p><p>如果主线程解析到 <code>link</code> 的位置，此时外部的 CSS 文件还没有下载解析好，主线程不会等待，继续解析后续的 HTML。这是因为下载和解析 CSS 的工作是在预解析线程中执行的。这就是 CSS 不会阻塞 HTML 解析的根本原因。</p><p>如果主线程解析到 <code>script</code> 的位置，会停止解析 HTML，转而等待 JS 文件下载好，并将全局代码解析执行完成后，才会继续解析 HTML。这是因为 JS 代码的执行过程可能会修改当前的 DOM 树，所以 DOM 树的生成必须暂停。这就是 JS 会阻塞 HTML 解析的根本原因。</p><p>第一步完成后，会得到 DOM 树 和 CSSOM 树，浏览器的默认样式、内部样式、外部样式、行内样式均会包含在 CSSOM 树中。</p><p>（2）渲染的第二步是 <strong>样式计算</strong>。</p><p>主线程会 <strong>遍历得到 <code>DOM</code>树</strong>。依次为树中的每个节点计算出最终的样式，这个过程称之为 Computed Style。</p><p>在这一过程中，很多预设值会变成绝对值，例如 <code>red</code> 会变成 <code>rgb(255, 0, 0)</code>，相对单位会变成绝对单位，比如 <code>em</code> 变成 <code>px</code>。</p><p>这一步完成后，会得到一颗 <strong>带有样式的 <code>DOM</code>树</strong>。</p><p>（3）第三步是 <strong>布局</strong>，布局完成后会得到 <strong>布局树</strong>。</p><p>布局阶段会依次遍历 DOM树 的每一个节点，计算每一个节点的几何信息。例如节点的宽高、相对包含块的位置。</p><p>大部分时候，<strong><code>DOM</code>树</strong> 和 <strong>布局树</strong> 并非一一对应。</p><p>比如：<code>display: none</code> 的节点没有几何信息，因此不会生成到 布局树，又比如使用了 <strong>伪元素选择器</strong>，虽然 <strong><code>DOM</code>树</strong> 中不存在这些 <strong>伪元素节点</strong>，但它们拥有几何信息，所以会生成到 <strong>布局树</strong> 种。还有 匿名行盒、匿名块盒等等都会导致 <strong><code>DOM</code>树</strong> 和 <strong>布局树</strong> 无法一一对应。</p><p>（4）第四步是 <strong>分层</strong></p><p>主线程会使用一套复杂的策略对整个 <strong>布局树</strong> 中进行 <strong>分层</strong>。</p><p><strong>分层</strong> 的好处在于，将来某一个层改变后，仅会对该层进行后续处理，从而提高效率。</p><p>滚动条、堆叠上下文、<code>transform</code>、<code>opacity</code> 等样式都会或多或少的影响分层的结果，也可以通过 <code>will-change</code> 属性更大程度的影响分层的结果。</p><p>（5）接下来的是 第五步 <strong>绘制</strong> 和 第六步 <strong>分块</strong></p><p>主线程会为每个层单独产生 <strong>绘制指令</strong> 集，用于描述这一层的内容该如何画出来。</p><p>完成绘制后，主线程将每个图层的绘制信息提交给 <strong>合成线程</strong>，剩余的工作将由 <strong>合成线程</strong> 完成。</p><p><strong>合成线程</strong> 首先对每个图层进行 <strong>分块</strong>，将其划分为更多的小区域。</p><p>它会从线程池中拿取多个线程来完成 <strong>分块</strong> 工作。</p><p>（6）第七步是 <strong>光栅化</strong></p><p><strong>分块</strong> 结束后，会进入 <strong>光栅化</strong> 阶段。</p><p><strong>合成线程</strong> 会将 <strong>块信息</strong> 交给 <strong>GPU</strong> 进程，以极高的速度完成 <strong>光栅化</strong>。</p><p><strong>GPU进程</strong> 会开启多个线程来完成 <strong>光栅化</strong>，并且优先处理靠近视口区域的 <strong>块</strong>。<strong>光栅化</strong> 的结果就是 一块一块 的 <strong>位图</strong>。</p><p>（7）最后一步就是 <strong>画</strong></p><p><strong>合成线程</strong> 拿到每个层、每个块的位图后，生成一个个 <code>quad</code> 信息（指引信息）。</p><p><strong>指引信息</strong> 会标识每个位图应该画到屏幕的哪个位置，以及会考虑到 <strong>旋转</strong>、<strong>缩放</strong> 等 <strong>形变</strong>。</p><p>形变发生在 <strong>合成线程</strong>，与 <strong>渲染主线程</strong> 无关，这就是 <code>transform</code> 效率高的本质原因。</p><p><strong>合成线程</strong> 会把 <code>quad</code> 提交给 <strong>GPU进程</strong>，由 <strong>GPU</strong> 进程产生系统调用，提交给 <strong>GPU</strong> 硬件，完成最终的屏幕成像。</p><h4 id="什么是-reflow" tabindex="-1"><a class="header-anchor" href="#什么是-reflow"><span>什么是 reflow？</span></a></h4><p><code>reflow</code> 的本质就是重新计算 <strong><code>layout</code> 树</strong>。</p><p>当进行了 <strong>会影响布局树的操作</strong> 后，需要重新计算 <strong>布局树</strong>，会引发 <code>layout</code>。</p><p>为了避免连续的多次操作导致 <strong>布局树</strong> 反复计算，浏览器会合并这些操作，当 <code>JS</code> 代码全部完成后再进行统一计算。所以，改动属性造成的 <code>reflow</code> 是 <strong>异步</strong> 的。</p><p>也同样因为如此，当 <code>JS</code> 获取布局属性时，就可能造成无法获取到最新的布局信息。</p><p>浏览器在反复权衡下，最终决定获取属性立即 <code>reflow</code>。</p><h4 id="什么是-repaint" tabindex="-1"><a class="header-anchor" href="#什么是-repaint"><span>什么是 repaint？</span></a></h4><p><code>repaint</code> 的本质就是重新根据 <strong>分层</strong> 信息计算了 <strong>绘制指令</strong>。</p><p>当改动了可见样式后，就需要重新计算，会引发 <code>repaint</code>。</p><p>由于元素的 <strong>布局信息</strong> 也属于可见样式，所以 <code>reflow</code> 一定会引起 <code>reapint</code>。</p><h4 id="为什么-transform-效率高" tabindex="-1"><a class="header-anchor" href="#为什么-transform-效率高"><span>为什么 transform 效率高？</span></a></h4><p><img src="/web-docs/assets/transform%E6%95%88%E7%8E%87-D7PFykbE.png" alt="transform效率"></p><p>因为 <code>transform</code> 它改动了样式之后，很多步骤都可以跳过，比方说这里，我们通过 <code>JS</code> 修改了样式，那么就会影响 <strong><code>CSSOM</code>树</strong> ，也就是影响了 <strong><code>style</code>样式计算</strong> 和 <code>draw</code> 这两个步骤。</p><p>但是，如果说你是使用 <code>animation</code> 的话，<strong><code>CSSOM</code> 树</strong> 都不会变化，就只会影响 <code>draw</code> 了，如下图所示：</p><p>![animation 的 transform](assets/animation 的 transform.png)</p><p>形变发生在 <strong>合成线程</strong>，与 <strong>渲染主线程</strong> 无关，这就是 <code>transform</code> 效率高的本质原因</p></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">上次编辑于: </span><!----></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: 893634104@qq.com">wr</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="route-link auto-link next" href="/web-docs/%E5%89%8D%E7%AB%AF/Browser/%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%E6%9C%BA%E5%88%B6/" aria-label="事件循环机制"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">事件循环机制<span class="font-icon icon iconfont icon-wenjian" style=""></span></div></a></nav><!----><!----><!--]--></main><!--]--><!----></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/web-docs/assets/app-Bgb0RMc4.js" defer></script>
  </body>
</html>
